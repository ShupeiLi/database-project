{% load staticfiles %}
<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <title>轨迹地图</title>
    <style>
        html,body,#parent{height: 100%; overflow: hidden;}
        #top{position: absolute; top: 0; left: 0; right: 0; height: 0; background-color: #F3F3FA; height:130px;}
        #left{position: absolute; top: 130px; left: 0; bottom: 50px; width: 75%; background-color: #E0E0E0; overflow:auto;}
        #right{position: absolute; top: 130px; left: 75%; right: 0; bottom: 50px; background-color: #FFFFCE; overflow:auto; line-height:22px}
        #bottom{position: absolute; left: 0; right: 0; bottom: 0; height: 50px; background-color: #F3F3FA}
        #container {width:1200px; height: 720px; }
    </style>
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.4.11&key=dfa6a5aec1c42d53d2af3380e195f6c6"></script>
</head>

<body>
    <div id="container">
        <div id="top"></div>
        <div id="left"></div>
        <div id="right"></div>
        <div id="bottom"></div>
    </div>
        <div class="input-card" style="width: auto;">
        <div class="input-item">
            <button class="btn" onclick="heatmap.show()">显示热力图</button>
        </div>
        <div class="input-item">
            <button class="btn" onclick="heatmap.hide()">关闭热力图</button>
        </div>
    </div>
    <script src="//webapi.amap.com/maps?v=1.4.15&key=您申请的key值"></script>
    <script src="{% static "js/heatmapdata.js" %}" type="text/javascript"></script>
    <script>
        var map = new AMap.Map('container', {
            resizeEnable: true,
            center: [121.48, 31.22],
            zoom: 11
        });
        
        // 折线的节点坐标数组，每个元素为 AMap.LngLat 对象
        var path = [];
        {% for i in path_dot %}
            path.push(new AMap.LngLat({{ i.1 }},{{ i.0 }}))
        {% endfor %}

        var polyline = new AMap.Polyline({
            path:path, //设置线覆盖物路径
            strokeColor:"#3366FF", //线颜色
            strokeOpacity:1, //线透明度
            strokeWeight:5, //线宽
            strokeStyle:"solid", //线样式
            strokeDasharray:[10,5] //补充线样式
            });

        //  将折线添加至地图实例
        map.add(polyline);
         
        if (!isSupportCanvas()) {
            alert('热力图仅对支持canvas的浏览器适用,您所使用的浏览器不能使用热力图功能,请换个浏览器试试~')
        }

        //详细的参数,可以查看heatmap.js的文档 http://www.patrick-wied.at/static/heatmapjs/docs.html
        //参数说明如下:
        /* visible 热力图是否显示,默认为true
        * opacity 热力图的透明度,分别对应heatmap.js的minOpacity和maxOpacity
        * radius 势力图的每个点的半径大小
        * gradient  {JSON} 热力图的渐变区间 . gradient如下所示
        *	{
        .2:'rgb(0, 255, 255)',
        .5:'rgb(0, 110, 255)',
        .8:'rgb(100, 0, 255)'
        }
        其中 key 表示插值的位置, 0-1
        value 为颜色值
        */
        var heatmap;
        map.plugin(["AMap.Heatmap"], function () {
        //初始化heatmap对象
            heatmap = new AMap.Heatmap(map, {
                radius: 25, //给定半径
                opacity: [0, 0.8]
                /*,
                gradient:{
                    0.5: 'blue',
                    0.65: 'rgb(117,211,248)',
                    0.7: 'rgb(0, 255, 0)',
                    0.9: '#ffea00',
                    1.0: 'red'
                }
                 */
            });
            //设置数据集：该数据为数据
            heatmap.setDataSet({
                data: heatmapData,
                max: 100
            });
        });

    //判断浏览区是否支持canvas
    function isSupportCanvas() {
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    }
    </script>
</body>
</html>
